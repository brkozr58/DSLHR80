*---------------------------------------------------------------------*
*    view related FORM routines
*   generation date: 16.07.2025 at 14:40:08
*   view maintenance generator version: #001407#
*---------------------------------------------------------------------*
*...processing: /DSL/HR80_V001..................................*
FORM GET_DATA_/DSL/HR80_V001.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_T001 WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_V001 .
/DSL/HR80_V001-MANDT =
/DSL/HR80_T001-MANDT .
/DSL/HR80_V001-MOLGA =
/DSL/HR80_T001-MOLGA .
/DSL/HR80_V001-GRPID =
/DSL/HR80_T001-GRPID .
/DSL/HR80_V001-GRPID_T =
/DSL/HR80_T001-GRPID_T .
<VIM_TOTAL_STRUC> = /DSL/HR80_V001.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_V001 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_V001.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_V001-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T001 WHERE
  GRPID = /DSL/HR80_V001-GRPID AND
  MOLGA = /DSL/HR80_V001-MOLGA .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_T001 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T001 WHERE
  GRPID = /DSL/HR80_V001-GRPID AND
  MOLGA = /DSL/HR80_V001-MOLGA .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_T001.
    ENDIF.
/DSL/HR80_T001-MANDT =
/DSL/HR80_V001-MANDT .
/DSL/HR80_T001-MOLGA =
/DSL/HR80_V001-MOLGA .
/DSL/HR80_T001-GRPID =
/DSL/HR80_V001-GRPID .
/DSL/HR80_T001-GRPID_T =
/DSL/HR80_V001-GRPID_T .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_T001 ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_T001 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_V001-UPD_FLAG,
STATUS_/DSL/HR80_V001-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_V001.
  SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_V001-GRPID AND
MOLGA = /DSL/HR80_V001-MOLGA .
/DSL/HR80_V001-MANDT =
/DSL/HR80_T001-MANDT .
/DSL/HR80_V001-MOLGA =
/DSL/HR80_T001-MOLGA .
/DSL/HR80_V001-GRPID =
/DSL/HR80_T001-GRPID .
/DSL/HR80_V001-GRPID_T =
/DSL/HR80_T001-GRPID_T .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_V001 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_V001-GRPID TO
/DSL/HR80_T001-GRPID .
MOVE /DSL/HR80_V001-MOLGA TO
/DSL/HR80_T001-MOLGA .
MOVE /DSL/HR80_V001-MANDT TO
/DSL/HR80_T001-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_T001'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_T001 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_T001'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: /DSL/HR80_V002..................................*
FORM GET_DATA_/DSL/HR80_V002.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_T002 WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_V002 .
/DSL/HR80_V002-MANDT =
/DSL/HR80_T002-MANDT .
/DSL/HR80_V002-MOLGA =
/DSL/HR80_T002-MOLGA .
/DSL/HR80_V002-GRPID =
/DSL/HR80_T002-GRPID .
/DSL/HR80_V002-BUKRS =
/DSL/HR80_T002-BUKRS .
/DSL/HR80_V002-WERKS =
/DSL/HR80_T002-WERKS .
/DSL/HR80_V002-BTRTL =
/DSL/HR80_T002-BTRTL .
/DSL/HR80_V002-ABKRS =
/DSL/HR80_T002-ABKRS .
    SELECT SINGLE * FROM T001 WHERE
BUKRS = /DSL/HR80_T002-BUKRS .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-BUTXT =
T001-BUTXT .
    ENDIF.
    SELECT SINGLE * FROM T001P WHERE
WERKS = /DSL/HR80_T002-WERKS AND
BTRTL = /DSL/HR80_T002-BTRTL .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-BTEXT =
T001P-BTEXT .
    ENDIF.
    SELECT SINGLE * FROM T500P WHERE
PERSA = /DSL/HR80_T002-WERKS .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-NAME1 =
T500P-NAME1 .
    ENDIF.
    SELECT SINGLE * FROM T549A WHERE
ABKRS = /DSL/HR80_T002-ABKRS .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T549T WHERE
ABKRS = T549A-ABKRS AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V002-ATEXT =
T549T-ATEXT .
      ENDIF.
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T002-GRPID AND
MOLGA = /DSL/HR80_T002-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ENDIF.
<VIM_TOTAL_STRUC> = /DSL/HR80_V002.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_V002 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_V002.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_V002-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T002 WHERE
  MOLGA = /DSL/HR80_V002-MOLGA AND
  GRPID = /DSL/HR80_V002-GRPID AND
  BUKRS = /DSL/HR80_V002-BUKRS AND
  WERKS = /DSL/HR80_V002-WERKS AND
  BTRTL = /DSL/HR80_V002-BTRTL AND
  ABKRS = /DSL/HR80_V002-ABKRS .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_T002 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T002 WHERE
  MOLGA = /DSL/HR80_V002-MOLGA AND
  GRPID = /DSL/HR80_V002-GRPID AND
  BUKRS = /DSL/HR80_V002-BUKRS AND
  WERKS = /DSL/HR80_V002-WERKS AND
  BTRTL = /DSL/HR80_V002-BTRTL AND
  ABKRS = /DSL/HR80_V002-ABKRS .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_T002.
    ENDIF.
/DSL/HR80_T002-MANDT =
/DSL/HR80_V002-MANDT .
/DSL/HR80_T002-MOLGA =
/DSL/HR80_V002-MOLGA .
/DSL/HR80_T002-GRPID =
/DSL/HR80_V002-GRPID .
/DSL/HR80_T002-BUKRS =
/DSL/HR80_V002-BUKRS .
/DSL/HR80_T002-WERKS =
/DSL/HR80_V002-WERKS .
/DSL/HR80_T002-BTRTL =
/DSL/HR80_V002-BTRTL .
/DSL/HR80_T002-ABKRS =
/DSL/HR80_V002-ABKRS .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_T002 ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_T002 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_V002-UPD_FLAG,
STATUS_/DSL/HR80_V002-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_V002.
  SELECT SINGLE * FROM /DSL/HR80_T002 WHERE
MOLGA = /DSL/HR80_V002-MOLGA AND
GRPID = /DSL/HR80_V002-GRPID AND
BUKRS = /DSL/HR80_V002-BUKRS AND
WERKS = /DSL/HR80_V002-WERKS AND
BTRTL = /DSL/HR80_V002-BTRTL AND
ABKRS = /DSL/HR80_V002-ABKRS .
/DSL/HR80_V002-MANDT =
/DSL/HR80_T002-MANDT .
/DSL/HR80_V002-MOLGA =
/DSL/HR80_T002-MOLGA .
/DSL/HR80_V002-GRPID =
/DSL/HR80_T002-GRPID .
/DSL/HR80_V002-BUKRS =
/DSL/HR80_T002-BUKRS .
/DSL/HR80_V002-WERKS =
/DSL/HR80_T002-WERKS .
/DSL/HR80_V002-BTRTL =
/DSL/HR80_T002-BTRTL .
/DSL/HR80_V002-ABKRS =
/DSL/HR80_T002-ABKRS .
    SELECT SINGLE * FROM T001 WHERE
BUKRS = /DSL/HR80_T002-BUKRS .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-BUTXT =
T001-BUTXT .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-BUTXT .
    ENDIF.
    SELECT SINGLE * FROM T001P WHERE
WERKS = /DSL/HR80_T002-WERKS AND
BTRTL = /DSL/HR80_T002-BTRTL .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-BTEXT =
T001P-BTEXT .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-BTEXT .
    ENDIF.
    SELECT SINGLE * FROM T500P WHERE
PERSA = /DSL/HR80_T002-WERKS .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-NAME1 =
T500P-NAME1 .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-NAME1 .
    ENDIF.
    SELECT SINGLE * FROM T549A WHERE
ABKRS = /DSL/HR80_T002-ABKRS .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T549T WHERE
ABKRS = T549A-ABKRS AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V002-ATEXT =
T549T-ATEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V002-ATEXT .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-ATEXT .
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T002-GRPID AND
MOLGA = /DSL/HR80_T002-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-GRPID_T .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_V002 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_V002-MOLGA TO
/DSL/HR80_T002-MOLGA .
MOVE /DSL/HR80_V002-GRPID TO
/DSL/HR80_T002-GRPID .
MOVE /DSL/HR80_V002-BUKRS TO
/DSL/HR80_T002-BUKRS .
MOVE /DSL/HR80_V002-WERKS TO
/DSL/HR80_T002-WERKS .
MOVE /DSL/HR80_V002-BTRTL TO
/DSL/HR80_T002-BTRTL .
MOVE /DSL/HR80_V002-ABKRS TO
/DSL/HR80_T002-ABKRS .
MOVE /DSL/HR80_V002-MANDT TO
/DSL/HR80_T002-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_T002'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_T002 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_T002'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_/DSL/HR80_V002 USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
/DSL/HR80_T002-MANDT =
/DSL/HR80_V002-MANDT .
/DSL/HR80_T002-MOLGA =
/DSL/HR80_V002-MOLGA .
/DSL/HR80_T002-GRPID =
/DSL/HR80_V002-GRPID .
/DSL/HR80_T002-BUKRS =
/DSL/HR80_V002-BUKRS .
/DSL/HR80_T002-WERKS =
/DSL/HR80_V002-WERKS .
/DSL/HR80_T002-BTRTL =
/DSL/HR80_V002-BTRTL .
/DSL/HR80_T002-ABKRS =
/DSL/HR80_V002-ABKRS .
    SELECT SINGLE * FROM T001 WHERE
BUKRS = /DSL/HR80_T002-BUKRS .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-BUTXT =
T001-BUTXT .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-BUTXT .
    ENDIF.
    SELECT SINGLE * FROM T001P WHERE
WERKS = /DSL/HR80_T002-WERKS AND
BTRTL = /DSL/HR80_T002-BTRTL .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-BTEXT =
T001P-BTEXT .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-BTEXT .
    ENDIF.
    SELECT SINGLE * FROM T500P WHERE
PERSA = /DSL/HR80_T002-WERKS .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-NAME1 =
T500P-NAME1 .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-NAME1 .
    ENDIF.
    SELECT SINGLE * FROM T549A WHERE
ABKRS = /DSL/HR80_T002-ABKRS .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T549T WHERE
ABKRS = T549A-ABKRS AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V002-ATEXT =
T549T-ATEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V002-ATEXT .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-ATEXT .
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T002-GRPID AND
MOLGA = /DSL/HR80_T002-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V002-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V002-GRPID_T .
    ENDIF.
ENDFORM.
*...processing: /DSL/HR80_V003..................................*
FORM GET_DATA_/DSL/HR80_V003.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_T003 WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_V003 .
/DSL/HR80_V003-MANDT =
/DSL/HR80_T003-MANDT .
/DSL/HR80_V003-MOLGA =
/DSL/HR80_T003-MOLGA .
/DSL/HR80_V003-GRPID =
/DSL/HR80_T003-GRPID .
/DSL/HR80_V003-GJAHR =
/DSL/HR80_T003-GJAHR .
/DSL/HR80_V003-VRSID =
/DSL/HR80_T003-VRSID .
/DSL/HR80_V003-VRSID_T =
/DSL/HR80_T003-VRSID_T .
/DSL/HR80_V003-STATU =
/DSL/HR80_T003-STATU .
/DSL/HR80_V003-BEGDA =
/DSL/HR80_T003-BEGDA .
/DSL/HR80_V003-ENDDA =
/DSL/HR80_T003-ENDDA .
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T003-GRPID AND
MOLGA = /DSL/HR80_T003-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V003-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ENDIF.
<VIM_TOTAL_STRUC> = /DSL/HR80_V003.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_V003 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_V003.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_V003-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T003 WHERE
  GJAHR = /DSL/HR80_V003-GJAHR AND
  GRPID = /DSL/HR80_V003-GRPID AND
  VRSID = /DSL/HR80_V003-VRSID AND
  MOLGA = /DSL/HR80_V003-MOLGA .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_T003 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T003 WHERE
  GJAHR = /DSL/HR80_V003-GJAHR AND
  GRPID = /DSL/HR80_V003-GRPID AND
  VRSID = /DSL/HR80_V003-VRSID AND
  MOLGA = /DSL/HR80_V003-MOLGA .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_T003.
    ENDIF.
/DSL/HR80_T003-MANDT =
/DSL/HR80_V003-MANDT .
/DSL/HR80_T003-MOLGA =
/DSL/HR80_V003-MOLGA .
/DSL/HR80_T003-GRPID =
/DSL/HR80_V003-GRPID .
/DSL/HR80_T003-GJAHR =
/DSL/HR80_V003-GJAHR .
/DSL/HR80_T003-VRSID =
/DSL/HR80_V003-VRSID .
/DSL/HR80_T003-VRSID_T =
/DSL/HR80_V003-VRSID_T .
/DSL/HR80_T003-STATU =
/DSL/HR80_V003-STATU .
/DSL/HR80_T003-BEGDA =
/DSL/HR80_V003-BEGDA .
/DSL/HR80_T003-ENDDA =
/DSL/HR80_V003-ENDDA .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_T003 ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_T003 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_V003-UPD_FLAG,
STATUS_/DSL/HR80_V003-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_V003.
  SELECT SINGLE * FROM /DSL/HR80_T003 WHERE
GJAHR = /DSL/HR80_V003-GJAHR AND
GRPID = /DSL/HR80_V003-GRPID AND
VRSID = /DSL/HR80_V003-VRSID AND
MOLGA = /DSL/HR80_V003-MOLGA .
/DSL/HR80_V003-MANDT =
/DSL/HR80_T003-MANDT .
/DSL/HR80_V003-MOLGA =
/DSL/HR80_T003-MOLGA .
/DSL/HR80_V003-GRPID =
/DSL/HR80_T003-GRPID .
/DSL/HR80_V003-GJAHR =
/DSL/HR80_T003-GJAHR .
/DSL/HR80_V003-VRSID =
/DSL/HR80_T003-VRSID .
/DSL/HR80_V003-VRSID_T =
/DSL/HR80_T003-VRSID_T .
/DSL/HR80_V003-STATU =
/DSL/HR80_T003-STATU .
/DSL/HR80_V003-BEGDA =
/DSL/HR80_T003-BEGDA .
/DSL/HR80_V003-ENDDA =
/DSL/HR80_T003-ENDDA .
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T003-GRPID AND
MOLGA = /DSL/HR80_T003-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V003-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V003-GRPID_T .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_V003 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_V003-GJAHR TO
/DSL/HR80_T003-GJAHR .
MOVE /DSL/HR80_V003-GRPID TO
/DSL/HR80_T003-GRPID .
MOVE /DSL/HR80_V003-VRSID TO
/DSL/HR80_T003-VRSID .
MOVE /DSL/HR80_V003-MOLGA TO
/DSL/HR80_T003-MOLGA .
MOVE /DSL/HR80_V003-MANDT TO
/DSL/HR80_T003-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_T003'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_T003 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_T003'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_/DSL/HR80_V003 USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
/DSL/HR80_T003-MANDT =
/DSL/HR80_V003-MANDT .
/DSL/HR80_T003-MOLGA =
/DSL/HR80_V003-MOLGA .
/DSL/HR80_T003-GRPID =
/DSL/HR80_V003-GRPID .
/DSL/HR80_T003-GJAHR =
/DSL/HR80_V003-GJAHR .
/DSL/HR80_T003-VRSID =
/DSL/HR80_V003-VRSID .
/DSL/HR80_T003-VRSID_T =
/DSL/HR80_V003-VRSID_T .
/DSL/HR80_T003-STATU =
/DSL/HR80_V003-STATU .
/DSL/HR80_T003-BEGDA =
/DSL/HR80_V003-BEGDA .
/DSL/HR80_T003-ENDDA =
/DSL/HR80_V003-ENDDA .
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T003-GRPID AND
MOLGA = /DSL/HR80_T003-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V003-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V003-GRPID_T .
    ENDIF.
ENDFORM.
*...processing: /DSL/HR80_V004..................................*
FORM GET_DATA_/DSL/HR80_V004.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_T004 WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_V004 .
/DSL/HR80_V004-MANDT =
/DSL/HR80_T004-MANDT .
/DSL/HR80_V004-MOLGA =
/DSL/HR80_T004-MOLGA .
/DSL/HR80_V004-GRPID =
/DSL/HR80_T004-GRPID .
/DSL/HR80_V004-VRSID =
/DSL/HR80_T004-VRSID .
/DSL/HR80_V004-BUKRS =
/DSL/HR80_T004-BUKRS .
/DSL/HR80_V004-KOSTL =
/DSL/HR80_T004-KOSTL .
/DSL/HR80_V004-ANSVH =
/DSL/HR80_T004-ANSVH .
/DSL/HR80_V004-WERKS =
/DSL/HR80_T004-WERKS .
/DSL/HR80_V004-BTRTL =
/DSL/HR80_T004-BTRTL .
/DSL/HR80_V004-PERSG =
/DSL/HR80_T004-PERSG .
/DSL/HR80_V004-PERSK =
/DSL/HR80_T004-PERSK .
/DSL/HR80_V004-ORGEH =
/DSL/HR80_T004-ORGEH .
/DSL/HR80_V004-STELL =
/DSL/HR80_T004-STELL .
/DSL/HR80_V004-ABKRS =
/DSL/HR80_T004-ABKRS .
/DSL/HR80_V004-PERNR =
/DSL/HR80_T004-PERNR .
/DSL/HR80_V004-RAT01 =
/DSL/HR80_T004-RAT01 .
/DSL/HR80_V004-ANZ01 =
/DSL/HR80_T004-ANZ01 .
/DSL/HR80_V004-BET01 =
/DSL/HR80_T004-BET01 .
/DSL/HR80_V004-RAT02 =
/DSL/HR80_T004-RAT02 .
/DSL/HR80_V004-ANZ02 =
/DSL/HR80_T004-ANZ02 .
/DSL/HR80_V004-BET02 =
/DSL/HR80_T004-BET02 .
/DSL/HR80_V004-RAT03 =
/DSL/HR80_T004-RAT03 .
/DSL/HR80_V004-ANZ03 =
/DSL/HR80_T004-ANZ03 .
/DSL/HR80_V004-BET03 =
/DSL/HR80_T004-BET03 .
/DSL/HR80_V004-RAT04 =
/DSL/HR80_T004-RAT04 .
/DSL/HR80_V004-ANZ04 =
/DSL/HR80_T004-ANZ04 .
/DSL/HR80_V004-BET04 =
/DSL/HR80_T004-BET04 .
/DSL/HR80_V004-RAT05 =
/DSL/HR80_T004-RAT05 .
/DSL/HR80_V004-ANZ05 =
/DSL/HR80_T004-ANZ05 .
/DSL/HR80_V004-BET05 =
/DSL/HR80_T004-BET05 .
/DSL/HR80_V004-RAT06 =
/DSL/HR80_T004-RAT06 .
/DSL/HR80_V004-ANZ06 =
/DSL/HR80_T004-ANZ06 .
/DSL/HR80_V004-BET06 =
/DSL/HR80_T004-BET06 .
/DSL/HR80_V004-RAT07 =
/DSL/HR80_T004-RAT07 .
/DSL/HR80_V004-ANZ07 =
/DSL/HR80_T004-ANZ07 .
/DSL/HR80_V004-BET07 =
/DSL/HR80_T004-BET07 .
/DSL/HR80_V004-RAT08 =
/DSL/HR80_T004-RAT08 .
/DSL/HR80_V004-ANZ08 =
/DSL/HR80_T004-ANZ08 .
/DSL/HR80_V004-BET08 =
/DSL/HR80_T004-BET08 .
/DSL/HR80_V004-RAT09 =
/DSL/HR80_T004-RAT09 .
/DSL/HR80_V004-ANZ09 =
/DSL/HR80_T004-ANZ09 .
/DSL/HR80_V004-BET09 =
/DSL/HR80_T004-BET09 .
/DSL/HR80_V004-RAT10 =
/DSL/HR80_T004-RAT10 .
/DSL/HR80_V004-ANZ10 =
/DSL/HR80_T004-ANZ10 .
/DSL/HR80_V004-BET10 =
/DSL/HR80_T004-BET10 .
/DSL/HR80_V004-RAT11 =
/DSL/HR80_T004-RAT11 .
/DSL/HR80_V004-ANZ11 =
/DSL/HR80_T004-ANZ11 .
/DSL/HR80_V004-BET11 =
/DSL/HR80_T004-BET11 .
/DSL/HR80_V004-RAT12 =
/DSL/HR80_T004-RAT12 .
/DSL/HR80_V004-ANZ12 =
/DSL/HR80_T004-ANZ12 .
/DSL/HR80_V004-BET12 =
/DSL/HR80_T004-BET12 .
/DSL/HR80_V004-WAERS =
/DSL/HR80_T004-WAERS .
    SELECT * FROM CSKS WHERE
KOSTL = /DSL/HR80_T004-KOSTL .
      SELECT SINGLE * FROM CSKT WHERE
KOKRS = CSKS-KOKRS AND
KOSTL = CSKS-KOSTL AND
DATBI = CSKS-DATBI AND
SPRAS = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-LTEXT =
CSKT-LTEXT .
      ENDIF.
      EXIT.
    ENDSELECT.
    SELECT SINGLE * FROM T001P WHERE
WERKS = /DSL/HR80_T004-WERKS AND
BTRTL = /DSL/HR80_T004-BTRTL .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V004-BTRTL_T =
T001P-BTEXT .
    ENDIF.
    SELECT SINGLE * FROM T500P WHERE
PERSA = /DSL/HR80_T004-WERKS .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V004-WERKS_T =
T500P-NAME1 .
    ENDIF.
    SELECT SINGLE * FROM T501 WHERE
PERSG = /DSL/HR80_T004-PERSG .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T501T WHERE
PERSG = T501-PERSG AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-PERSG_T =
T501T-PTEXT .
      ENDIF.
    ENDIF.
    SELECT SINGLE * FROM T503K WHERE
PERSK = /DSL/HR80_T004-PERSK .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T503T WHERE
PERSK = T503K-PERSK AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-PERSK_T =
T503T-PTEXT .
      ENDIF.
    ENDIF.
    SELECT SINGLE * FROM T542A WHERE
MOLGA = '47' AND
ANSVH = /DSL/HR80_T004-ANSVH .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T542T WHERE
MOLGA = T542A-MOLGA AND
ANSVH = T542A-ANSVH AND
SPRAS = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-ATX =
T542T-ATX .
      ENDIF.
    ENDIF.
    SELECT SINGLE * FROM T549A WHERE
ABKRS = /DSL/HR80_T004-ABKRS .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T549T WHERE
ABKRS = T549A-ABKRS AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-ATEXT =
T549T-ATEXT .
      ENDIF.
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T004-GRPID AND
MOLGA = /DSL/HR80_T004-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V004-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_T004-GRPID AND
VRSID = /DSL/HR80_T004-VRSID AND
MOLGA = /DSL/HR80_T004-MOLGA .
/DSL/HR80_V004-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      EXIT.
    ENDSELECT.
<VIM_TOTAL_STRUC> = /DSL/HR80_V004.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_V004 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_V004.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_V004-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T004 WHERE
  MOLGA = /DSL/HR80_V004-MOLGA AND
  GRPID = /DSL/HR80_V004-GRPID AND
  VRSID = /DSL/HR80_V004-VRSID AND
  BUKRS = /DSL/HR80_V004-BUKRS AND
  KOSTL = /DSL/HR80_V004-KOSTL AND
  ANSVH = /DSL/HR80_V004-ANSVH AND
  WERKS = /DSL/HR80_V004-WERKS AND
  BTRTL = /DSL/HR80_V004-BTRTL AND
  PERSG = /DSL/HR80_V004-PERSG AND
  PERSK = /DSL/HR80_V004-PERSK AND
  ORGEH = /DSL/HR80_V004-ORGEH AND
  STELL = /DSL/HR80_V004-STELL AND
  ABKRS = /DSL/HR80_V004-ABKRS AND
  PERNR = /DSL/HR80_V004-PERNR .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_T004 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T004 WHERE
  MOLGA = /DSL/HR80_V004-MOLGA AND
  GRPID = /DSL/HR80_V004-GRPID AND
  VRSID = /DSL/HR80_V004-VRSID AND
  BUKRS = /DSL/HR80_V004-BUKRS AND
  KOSTL = /DSL/HR80_V004-KOSTL AND
  ANSVH = /DSL/HR80_V004-ANSVH AND
  WERKS = /DSL/HR80_V004-WERKS AND
  BTRTL = /DSL/HR80_V004-BTRTL AND
  PERSG = /DSL/HR80_V004-PERSG AND
  PERSK = /DSL/HR80_V004-PERSK AND
  ORGEH = /DSL/HR80_V004-ORGEH AND
  STELL = /DSL/HR80_V004-STELL AND
  ABKRS = /DSL/HR80_V004-ABKRS AND
  PERNR = /DSL/HR80_V004-PERNR .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_T004.
    ENDIF.
/DSL/HR80_T004-MANDT =
/DSL/HR80_V004-MANDT .
/DSL/HR80_T004-MOLGA =
/DSL/HR80_V004-MOLGA .
/DSL/HR80_T004-GRPID =
/DSL/HR80_V004-GRPID .
/DSL/HR80_T004-VRSID =
/DSL/HR80_V004-VRSID .
/DSL/HR80_T004-BUKRS =
/DSL/HR80_V004-BUKRS .
/DSL/HR80_T004-KOSTL =
/DSL/HR80_V004-KOSTL .
/DSL/HR80_T004-ANSVH =
/DSL/HR80_V004-ANSVH .
/DSL/HR80_T004-WERKS =
/DSL/HR80_V004-WERKS .
/DSL/HR80_T004-BTRTL =
/DSL/HR80_V004-BTRTL .
/DSL/HR80_T004-PERSG =
/DSL/HR80_V004-PERSG .
/DSL/HR80_T004-PERSK =
/DSL/HR80_V004-PERSK .
/DSL/HR80_T004-ORGEH =
/DSL/HR80_V004-ORGEH .
/DSL/HR80_T004-STELL =
/DSL/HR80_V004-STELL .
/DSL/HR80_T004-ABKRS =
/DSL/HR80_V004-ABKRS .
/DSL/HR80_T004-PERNR =
/DSL/HR80_V004-PERNR .
/DSL/HR80_T004-RAT01 =
/DSL/HR80_V004-RAT01 .
/DSL/HR80_T004-ANZ01 =
/DSL/HR80_V004-ANZ01 .
/DSL/HR80_T004-BET01 =
/DSL/HR80_V004-BET01 .
/DSL/HR80_T004-RAT02 =
/DSL/HR80_V004-RAT02 .
/DSL/HR80_T004-ANZ02 =
/DSL/HR80_V004-ANZ02 .
/DSL/HR80_T004-BET02 =
/DSL/HR80_V004-BET02 .
/DSL/HR80_T004-RAT03 =
/DSL/HR80_V004-RAT03 .
/DSL/HR80_T004-ANZ03 =
/DSL/HR80_V004-ANZ03 .
/DSL/HR80_T004-BET03 =
/DSL/HR80_V004-BET03 .
/DSL/HR80_T004-RAT04 =
/DSL/HR80_V004-RAT04 .
/DSL/HR80_T004-ANZ04 =
/DSL/HR80_V004-ANZ04 .
/DSL/HR80_T004-BET04 =
/DSL/HR80_V004-BET04 .
/DSL/HR80_T004-RAT05 =
/DSL/HR80_V004-RAT05 .
/DSL/HR80_T004-ANZ05 =
/DSL/HR80_V004-ANZ05 .
/DSL/HR80_T004-BET05 =
/DSL/HR80_V004-BET05 .
/DSL/HR80_T004-RAT06 =
/DSL/HR80_V004-RAT06 .
/DSL/HR80_T004-ANZ06 =
/DSL/HR80_V004-ANZ06 .
/DSL/HR80_T004-BET06 =
/DSL/HR80_V004-BET06 .
/DSL/HR80_T004-RAT07 =
/DSL/HR80_V004-RAT07 .
/DSL/HR80_T004-ANZ07 =
/DSL/HR80_V004-ANZ07 .
/DSL/HR80_T004-BET07 =
/DSL/HR80_V004-BET07 .
/DSL/HR80_T004-RAT08 =
/DSL/HR80_V004-RAT08 .
/DSL/HR80_T004-ANZ08 =
/DSL/HR80_V004-ANZ08 .
/DSL/HR80_T004-BET08 =
/DSL/HR80_V004-BET08 .
/DSL/HR80_T004-RAT09 =
/DSL/HR80_V004-RAT09 .
/DSL/HR80_T004-ANZ09 =
/DSL/HR80_V004-ANZ09 .
/DSL/HR80_T004-BET09 =
/DSL/HR80_V004-BET09 .
/DSL/HR80_T004-RAT10 =
/DSL/HR80_V004-RAT10 .
/DSL/HR80_T004-ANZ10 =
/DSL/HR80_V004-ANZ10 .
/DSL/HR80_T004-BET10 =
/DSL/HR80_V004-BET10 .
/DSL/HR80_T004-RAT11 =
/DSL/HR80_V004-RAT11 .
/DSL/HR80_T004-ANZ11 =
/DSL/HR80_V004-ANZ11 .
/DSL/HR80_T004-BET11 =
/DSL/HR80_V004-BET11 .
/DSL/HR80_T004-RAT12 =
/DSL/HR80_V004-RAT12 .
/DSL/HR80_T004-ANZ12 =
/DSL/HR80_V004-ANZ12 .
/DSL/HR80_T004-BET12 =
/DSL/HR80_V004-BET12 .
/DSL/HR80_T004-WAERS =
/DSL/HR80_V004-WAERS .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_T004 ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_T004 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_V004-UPD_FLAG,
STATUS_/DSL/HR80_V004-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_V004.
  SELECT SINGLE * FROM /DSL/HR80_T004 WHERE
MOLGA = /DSL/HR80_V004-MOLGA AND
GRPID = /DSL/HR80_V004-GRPID AND
VRSID = /DSL/HR80_V004-VRSID AND
BUKRS = /DSL/HR80_V004-BUKRS AND
KOSTL = /DSL/HR80_V004-KOSTL AND
ANSVH = /DSL/HR80_V004-ANSVH AND
WERKS = /DSL/HR80_V004-WERKS AND
BTRTL = /DSL/HR80_V004-BTRTL AND
PERSG = /DSL/HR80_V004-PERSG AND
PERSK = /DSL/HR80_V004-PERSK AND
ORGEH = /DSL/HR80_V004-ORGEH AND
STELL = /DSL/HR80_V004-STELL AND
ABKRS = /DSL/HR80_V004-ABKRS AND
PERNR = /DSL/HR80_V004-PERNR .
/DSL/HR80_V004-MANDT =
/DSL/HR80_T004-MANDT .
/DSL/HR80_V004-MOLGA =
/DSL/HR80_T004-MOLGA .
/DSL/HR80_V004-GRPID =
/DSL/HR80_T004-GRPID .
/DSL/HR80_V004-VRSID =
/DSL/HR80_T004-VRSID .
/DSL/HR80_V004-BUKRS =
/DSL/HR80_T004-BUKRS .
/DSL/HR80_V004-KOSTL =
/DSL/HR80_T004-KOSTL .
/DSL/HR80_V004-ANSVH =
/DSL/HR80_T004-ANSVH .
/DSL/HR80_V004-WERKS =
/DSL/HR80_T004-WERKS .
/DSL/HR80_V004-BTRTL =
/DSL/HR80_T004-BTRTL .
/DSL/HR80_V004-PERSG =
/DSL/HR80_T004-PERSG .
/DSL/HR80_V004-PERSK =
/DSL/HR80_T004-PERSK .
/DSL/HR80_V004-ORGEH =
/DSL/HR80_T004-ORGEH .
/DSL/HR80_V004-STELL =
/DSL/HR80_T004-STELL .
/DSL/HR80_V004-ABKRS =
/DSL/HR80_T004-ABKRS .
/DSL/HR80_V004-PERNR =
/DSL/HR80_T004-PERNR .
/DSL/HR80_V004-RAT01 =
/DSL/HR80_T004-RAT01 .
/DSL/HR80_V004-ANZ01 =
/DSL/HR80_T004-ANZ01 .
/DSL/HR80_V004-BET01 =
/DSL/HR80_T004-BET01 .
/DSL/HR80_V004-RAT02 =
/DSL/HR80_T004-RAT02 .
/DSL/HR80_V004-ANZ02 =
/DSL/HR80_T004-ANZ02 .
/DSL/HR80_V004-BET02 =
/DSL/HR80_T004-BET02 .
/DSL/HR80_V004-RAT03 =
/DSL/HR80_T004-RAT03 .
/DSL/HR80_V004-ANZ03 =
/DSL/HR80_T004-ANZ03 .
/DSL/HR80_V004-BET03 =
/DSL/HR80_T004-BET03 .
/DSL/HR80_V004-RAT04 =
/DSL/HR80_T004-RAT04 .
/DSL/HR80_V004-ANZ04 =
/DSL/HR80_T004-ANZ04 .
/DSL/HR80_V004-BET04 =
/DSL/HR80_T004-BET04 .
/DSL/HR80_V004-RAT05 =
/DSL/HR80_T004-RAT05 .
/DSL/HR80_V004-ANZ05 =
/DSL/HR80_T004-ANZ05 .
/DSL/HR80_V004-BET05 =
/DSL/HR80_T004-BET05 .
/DSL/HR80_V004-RAT06 =
/DSL/HR80_T004-RAT06 .
/DSL/HR80_V004-ANZ06 =
/DSL/HR80_T004-ANZ06 .
/DSL/HR80_V004-BET06 =
/DSL/HR80_T004-BET06 .
/DSL/HR80_V004-RAT07 =
/DSL/HR80_T004-RAT07 .
/DSL/HR80_V004-ANZ07 =
/DSL/HR80_T004-ANZ07 .
/DSL/HR80_V004-BET07 =
/DSL/HR80_T004-BET07 .
/DSL/HR80_V004-RAT08 =
/DSL/HR80_T004-RAT08 .
/DSL/HR80_V004-ANZ08 =
/DSL/HR80_T004-ANZ08 .
/DSL/HR80_V004-BET08 =
/DSL/HR80_T004-BET08 .
/DSL/HR80_V004-RAT09 =
/DSL/HR80_T004-RAT09 .
/DSL/HR80_V004-ANZ09 =
/DSL/HR80_T004-ANZ09 .
/DSL/HR80_V004-BET09 =
/DSL/HR80_T004-BET09 .
/DSL/HR80_V004-RAT10 =
/DSL/HR80_T004-RAT10 .
/DSL/HR80_V004-ANZ10 =
/DSL/HR80_T004-ANZ10 .
/DSL/HR80_V004-BET10 =
/DSL/HR80_T004-BET10 .
/DSL/HR80_V004-RAT11 =
/DSL/HR80_T004-RAT11 .
/DSL/HR80_V004-ANZ11 =
/DSL/HR80_T004-ANZ11 .
/DSL/HR80_V004-BET11 =
/DSL/HR80_T004-BET11 .
/DSL/HR80_V004-RAT12 =
/DSL/HR80_T004-RAT12 .
/DSL/HR80_V004-ANZ12 =
/DSL/HR80_T004-ANZ12 .
/DSL/HR80_V004-BET12 =
/DSL/HR80_T004-BET12 .
/DSL/HR80_V004-WAERS =
/DSL/HR80_T004-WAERS .
    SELECT * FROM CSKS WHERE
KOSTL = /DSL/HR80_T004-KOSTL .
      SELECT SINGLE * FROM CSKT WHERE
KOKRS = CSKS-KOKRS AND
KOSTL = CSKS-KOSTL AND
DATBI = CSKS-DATBI AND
SPRAS = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-LTEXT =
CSKT-LTEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-LTEXT .
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-LTEXT .
    ENDIF.
    SELECT SINGLE * FROM T001P WHERE
WERKS = /DSL/HR80_T004-WERKS AND
BTRTL = /DSL/HR80_T004-BTRTL .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V004-BTRTL_T =
T001P-BTEXT .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-BTRTL_T .
    ENDIF.
    SELECT SINGLE * FROM T500P WHERE
PERSA = /DSL/HR80_T004-WERKS .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V004-WERKS_T =
T500P-NAME1 .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-WERKS_T .
    ENDIF.
    SELECT SINGLE * FROM T501 WHERE
PERSG = /DSL/HR80_T004-PERSG .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T501T WHERE
PERSG = T501-PERSG AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-PERSG_T =
T501T-PTEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-PERSG_T .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-PERSG_T .
    ENDIF.
    SELECT SINGLE * FROM T503K WHERE
PERSK = /DSL/HR80_T004-PERSK .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T503T WHERE
PERSK = T503K-PERSK AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-PERSK_T =
T503T-PTEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-PERSK_T .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-PERSK_T .
    ENDIF.
    SELECT SINGLE * FROM T542A WHERE
MOLGA = '47' AND
ANSVH = /DSL/HR80_T004-ANSVH .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T542T WHERE
MOLGA = T542A-MOLGA AND
ANSVH = T542A-ANSVH AND
SPRAS = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-ATX =
T542T-ATX .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-ATX .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-ATX .
    ENDIF.
    SELECT SINGLE * FROM T549A WHERE
ABKRS = /DSL/HR80_T004-ABKRS .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T549T WHERE
ABKRS = T549A-ABKRS AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-ATEXT =
T549T-ATEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-ATEXT .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-ATEXT .
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T004-GRPID AND
MOLGA = /DSL/HR80_T004-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V004-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-GRPID_T .
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_T004-GRPID AND
VRSID = /DSL/HR80_T004-VRSID AND
MOLGA = /DSL/HR80_T004-MOLGA .
/DSL/HR80_V004-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-VRSID_T .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_V004 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_V004-MOLGA TO
/DSL/HR80_T004-MOLGA .
MOVE /DSL/HR80_V004-GRPID TO
/DSL/HR80_T004-GRPID .
MOVE /DSL/HR80_V004-VRSID TO
/DSL/HR80_T004-VRSID .
MOVE /DSL/HR80_V004-BUKRS TO
/DSL/HR80_T004-BUKRS .
MOVE /DSL/HR80_V004-KOSTL TO
/DSL/HR80_T004-KOSTL .
MOVE /DSL/HR80_V004-ANSVH TO
/DSL/HR80_T004-ANSVH .
MOVE /DSL/HR80_V004-WERKS TO
/DSL/HR80_T004-WERKS .
MOVE /DSL/HR80_V004-BTRTL TO
/DSL/HR80_T004-BTRTL .
MOVE /DSL/HR80_V004-PERSG TO
/DSL/HR80_T004-PERSG .
MOVE /DSL/HR80_V004-PERSK TO
/DSL/HR80_T004-PERSK .
MOVE /DSL/HR80_V004-ORGEH TO
/DSL/HR80_T004-ORGEH .
MOVE /DSL/HR80_V004-STELL TO
/DSL/HR80_T004-STELL .
MOVE /DSL/HR80_V004-ABKRS TO
/DSL/HR80_T004-ABKRS .
MOVE /DSL/HR80_V004-PERNR TO
/DSL/HR80_T004-PERNR .
MOVE /DSL/HR80_V004-MANDT TO
/DSL/HR80_T004-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_T004'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_T004 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_T004'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_/DSL/HR80_V004 USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
/DSL/HR80_T004-MANDT =
/DSL/HR80_V004-MANDT .
/DSL/HR80_T004-MOLGA =
/DSL/HR80_V004-MOLGA .
/DSL/HR80_T004-GRPID =
/DSL/HR80_V004-GRPID .
/DSL/HR80_T004-VRSID =
/DSL/HR80_V004-VRSID .
/DSL/HR80_T004-BUKRS =
/DSL/HR80_V004-BUKRS .
/DSL/HR80_T004-KOSTL =
/DSL/HR80_V004-KOSTL .
/DSL/HR80_T004-ANSVH =
/DSL/HR80_V004-ANSVH .
/DSL/HR80_T004-WERKS =
/DSL/HR80_V004-WERKS .
/DSL/HR80_T004-BTRTL =
/DSL/HR80_V004-BTRTL .
/DSL/HR80_T004-PERSG =
/DSL/HR80_V004-PERSG .
/DSL/HR80_T004-PERSK =
/DSL/HR80_V004-PERSK .
/DSL/HR80_T004-ORGEH =
/DSL/HR80_V004-ORGEH .
/DSL/HR80_T004-STELL =
/DSL/HR80_V004-STELL .
/DSL/HR80_T004-ABKRS =
/DSL/HR80_V004-ABKRS .
/DSL/HR80_T004-PERNR =
/DSL/HR80_V004-PERNR .
/DSL/HR80_T004-RAT01 =
/DSL/HR80_V004-RAT01 .
/DSL/HR80_T004-ANZ01 =
/DSL/HR80_V004-ANZ01 .
/DSL/HR80_T004-BET01 =
/DSL/HR80_V004-BET01 .
/DSL/HR80_T004-RAT02 =
/DSL/HR80_V004-RAT02 .
/DSL/HR80_T004-ANZ02 =
/DSL/HR80_V004-ANZ02 .
/DSL/HR80_T004-BET02 =
/DSL/HR80_V004-BET02 .
/DSL/HR80_T004-RAT03 =
/DSL/HR80_V004-RAT03 .
/DSL/HR80_T004-ANZ03 =
/DSL/HR80_V004-ANZ03 .
/DSL/HR80_T004-BET03 =
/DSL/HR80_V004-BET03 .
/DSL/HR80_T004-RAT04 =
/DSL/HR80_V004-RAT04 .
/DSL/HR80_T004-ANZ04 =
/DSL/HR80_V004-ANZ04 .
/DSL/HR80_T004-BET04 =
/DSL/HR80_V004-BET04 .
/DSL/HR80_T004-RAT05 =
/DSL/HR80_V004-RAT05 .
/DSL/HR80_T004-ANZ05 =
/DSL/HR80_V004-ANZ05 .
/DSL/HR80_T004-BET05 =
/DSL/HR80_V004-BET05 .
/DSL/HR80_T004-RAT06 =
/DSL/HR80_V004-RAT06 .
/DSL/HR80_T004-ANZ06 =
/DSL/HR80_V004-ANZ06 .
/DSL/HR80_T004-BET06 =
/DSL/HR80_V004-BET06 .
/DSL/HR80_T004-RAT07 =
/DSL/HR80_V004-RAT07 .
/DSL/HR80_T004-ANZ07 =
/DSL/HR80_V004-ANZ07 .
/DSL/HR80_T004-BET07 =
/DSL/HR80_V004-BET07 .
/DSL/HR80_T004-RAT08 =
/DSL/HR80_V004-RAT08 .
/DSL/HR80_T004-ANZ08 =
/DSL/HR80_V004-ANZ08 .
/DSL/HR80_T004-BET08 =
/DSL/HR80_V004-BET08 .
/DSL/HR80_T004-RAT09 =
/DSL/HR80_V004-RAT09 .
/DSL/HR80_T004-ANZ09 =
/DSL/HR80_V004-ANZ09 .
/DSL/HR80_T004-BET09 =
/DSL/HR80_V004-BET09 .
/DSL/HR80_T004-RAT10 =
/DSL/HR80_V004-RAT10 .
/DSL/HR80_T004-ANZ10 =
/DSL/HR80_V004-ANZ10 .
/DSL/HR80_T004-BET10 =
/DSL/HR80_V004-BET10 .
/DSL/HR80_T004-RAT11 =
/DSL/HR80_V004-RAT11 .
/DSL/HR80_T004-ANZ11 =
/DSL/HR80_V004-ANZ11 .
/DSL/HR80_T004-BET11 =
/DSL/HR80_V004-BET11 .
/DSL/HR80_T004-RAT12 =
/DSL/HR80_V004-RAT12 .
/DSL/HR80_T004-ANZ12 =
/DSL/HR80_V004-ANZ12 .
/DSL/HR80_T004-BET12 =
/DSL/HR80_V004-BET12 .
/DSL/HR80_T004-WAERS =
/DSL/HR80_V004-WAERS .
    SELECT * FROM CSKS WHERE
KOSTL = /DSL/HR80_T004-KOSTL .
      SELECT SINGLE * FROM CSKT WHERE
KOKRS = CSKS-KOKRS AND
KOSTL = CSKS-KOSTL AND
DATBI = CSKS-DATBI AND
SPRAS = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-LTEXT =
CSKT-LTEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-LTEXT .
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-LTEXT .
    ENDIF.
    SELECT SINGLE * FROM T001P WHERE
WERKS = /DSL/HR80_T004-WERKS AND
BTRTL = /DSL/HR80_T004-BTRTL .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V004-BTRTL_T =
T001P-BTEXT .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-BTRTL_T .
    ENDIF.
    SELECT SINGLE * FROM T500P WHERE
PERSA = /DSL/HR80_T004-WERKS .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V004-WERKS_T =
T500P-NAME1 .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-WERKS_T .
    ENDIF.
    SELECT SINGLE * FROM T501 WHERE
PERSG = /DSL/HR80_T004-PERSG .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T501T WHERE
PERSG = T501-PERSG AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-PERSG_T =
T501T-PTEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-PERSG_T .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-PERSG_T .
    ENDIF.
    SELECT SINGLE * FROM T503K WHERE
PERSK = /DSL/HR80_T004-PERSK .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T503T WHERE
PERSK = T503K-PERSK AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-PERSK_T =
T503T-PTEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-PERSK_T .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-PERSK_T .
    ENDIF.
    SELECT SINGLE * FROM T542A WHERE
MOLGA = '47' AND
ANSVH = /DSL/HR80_T004-ANSVH .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T542T WHERE
MOLGA = T542A-MOLGA AND
ANSVH = T542A-ANSVH AND
SPRAS = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-ATX =
T542T-ATX .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-ATX .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-ATX .
    ENDIF.
    SELECT SINGLE * FROM T549A WHERE
ABKRS = /DSL/HR80_T004-ABKRS .
    IF SY-SUBRC EQ 0.
      SELECT SINGLE * FROM T549T WHERE
ABKRS = T549A-ABKRS AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V004-ATEXT =
T549T-ATEXT .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V004-ATEXT .
      ENDIF.
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-ATEXT .
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T004-GRPID AND
MOLGA = /DSL/HR80_T004-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_V004-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-GRPID_T .
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_T004-GRPID AND
VRSID = /DSL/HR80_T004-VRSID AND
MOLGA = /DSL/HR80_T004-MOLGA .
/DSL/HR80_V004-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V004-VRSID_T .
    ENDIF.
ENDFORM.
*...processing: /DSL/HR80_V005..................................*
FORM GET_DATA_/DSL/HR80_V005.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_T005 WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_V005 .
/DSL/HR80_V005-MANDT =
/DSL/HR80_T005-MANDT .
/DSL/HR80_V005-MOLGA =
/DSL/HR80_T005-MOLGA .
/DSL/HR80_V005-GRPID =
/DSL/HR80_T005-GRPID .
/DSL/HR80_V005-VRSID =
/DSL/HR80_T005-VRSID .
/DSL/HR80_V005-PERNR =
/DSL/HR80_T005-PERNR .
/DSL/HR80_V005-LGART =
/DSL/HR80_T005-LGART .
/DSL/HR80_V005-BEGDA =
/DSL/HR80_T005-BEGDA .
/DSL/HR80_V005-ENDDA =
/DSL/HR80_T005-ENDDA .
/DSL/HR80_V005-ANZHL =
/DSL/HR80_T005-ANZHL .
/DSL/HR80_V005-BETRG =
/DSL/HR80_T005-BETRG .
    SELECT * FROM T512W WHERE
LGART = /DSL/HR80_T005-LGART .
      SELECT SINGLE * FROM T512T WHERE
MOLGA = T512W-MOLGA AND
LGART = T512W-LGART AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
      ENDIF.
      EXIT.
    ENDSELECT.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_T005-GRPID AND
VRSID = /DSL/HR80_T005-VRSID AND
MOLGA = /DSL/HR80_T005-MOLGA .
/DSL/HR80_V005-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T003-GRPID AND
MOLGA = /DSL/HR80_T003-MOLGA .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V005-GRPID_T =
/DSL/HR80_T001-GRPID_T .
      ENDIF.
      EXIT.
    ENDSELECT.
<VIM_TOTAL_STRUC> = /DSL/HR80_V005.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_V005 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_V005.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_V005-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T005 WHERE
  MOLGA = /DSL/HR80_V005-MOLGA AND
  GRPID = /DSL/HR80_V005-GRPID AND
  VRSID = /DSL/HR80_V005-VRSID AND
  PERNR = /DSL/HR80_V005-PERNR AND
  LGART = /DSL/HR80_V005-LGART AND
  BEGDA = /DSL/HR80_V005-BEGDA AND
  ENDDA = /DSL/HR80_V005-ENDDA .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_T005 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T005 WHERE
  MOLGA = /DSL/HR80_V005-MOLGA AND
  GRPID = /DSL/HR80_V005-GRPID AND
  VRSID = /DSL/HR80_V005-VRSID AND
  PERNR = /DSL/HR80_V005-PERNR AND
  LGART = /DSL/HR80_V005-LGART AND
  BEGDA = /DSL/HR80_V005-BEGDA AND
  ENDDA = /DSL/HR80_V005-ENDDA .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_T005.
    ENDIF.
/DSL/HR80_T005-MANDT =
/DSL/HR80_V005-MANDT .
/DSL/HR80_T005-MOLGA =
/DSL/HR80_V005-MOLGA .
/DSL/HR80_T005-GRPID =
/DSL/HR80_V005-GRPID .
/DSL/HR80_T005-VRSID =
/DSL/HR80_V005-VRSID .
/DSL/HR80_T005-PERNR =
/DSL/HR80_V005-PERNR .
/DSL/HR80_T005-LGART =
/DSL/HR80_V005-LGART .
/DSL/HR80_T005-BEGDA =
/DSL/HR80_V005-BEGDA .
/DSL/HR80_T005-ENDDA =
/DSL/HR80_V005-ENDDA .
/DSL/HR80_T005-ANZHL =
/DSL/HR80_V005-ANZHL .
/DSL/HR80_T005-BETRG =
/DSL/HR80_V005-BETRG .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_T005 ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_T005 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_V005-UPD_FLAG,
STATUS_/DSL/HR80_V005-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_V005.
  SELECT SINGLE * FROM /DSL/HR80_T005 WHERE
MOLGA = /DSL/HR80_V005-MOLGA AND
GRPID = /DSL/HR80_V005-GRPID AND
VRSID = /DSL/HR80_V005-VRSID AND
PERNR = /DSL/HR80_V005-PERNR AND
LGART = /DSL/HR80_V005-LGART AND
BEGDA = /DSL/HR80_V005-BEGDA AND
ENDDA = /DSL/HR80_V005-ENDDA .
/DSL/HR80_V005-MANDT =
/DSL/HR80_T005-MANDT .
/DSL/HR80_V005-MOLGA =
/DSL/HR80_T005-MOLGA .
/DSL/HR80_V005-GRPID =
/DSL/HR80_T005-GRPID .
/DSL/HR80_V005-VRSID =
/DSL/HR80_T005-VRSID .
/DSL/HR80_V005-PERNR =
/DSL/HR80_T005-PERNR .
/DSL/HR80_V005-LGART =
/DSL/HR80_T005-LGART .
/DSL/HR80_V005-BEGDA =
/DSL/HR80_T005-BEGDA .
/DSL/HR80_V005-ENDDA =
/DSL/HR80_T005-ENDDA .
/DSL/HR80_V005-ANZHL =
/DSL/HR80_T005-ANZHL .
/DSL/HR80_V005-BETRG =
/DSL/HR80_T005-BETRG .
    SELECT * FROM T512W WHERE
LGART = /DSL/HR80_T005-LGART .
      SELECT SINGLE * FROM T512T WHERE
MOLGA = T512W-MOLGA AND
LGART = T512W-LGART AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
      ELSE.
        CLEAR SY-SUBRC.
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_T005-GRPID AND
VRSID = /DSL/HR80_T005-VRSID AND
MOLGA = /DSL/HR80_T005-MOLGA .
/DSL/HR80_V005-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T003-GRPID AND
MOLGA = /DSL/HR80_T003-MOLGA .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V005-GRPID_T =
/DSL/HR80_T001-GRPID_T .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V005-GRPID_T .
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V005-VRSID_T .
      CLEAR /DSL/HR80_V005-GRPID_T .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_V005 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_V005-MOLGA TO
/DSL/HR80_T005-MOLGA .
MOVE /DSL/HR80_V005-GRPID TO
/DSL/HR80_T005-GRPID .
MOVE /DSL/HR80_V005-VRSID TO
/DSL/HR80_T005-VRSID .
MOVE /DSL/HR80_V005-PERNR TO
/DSL/HR80_T005-PERNR .
MOVE /DSL/HR80_V005-LGART TO
/DSL/HR80_T005-LGART .
MOVE /DSL/HR80_V005-BEGDA TO
/DSL/HR80_T005-BEGDA .
MOVE /DSL/HR80_V005-ENDDA TO
/DSL/HR80_T005-ENDDA .
MOVE /DSL/HR80_V005-MANDT TO
/DSL/HR80_T005-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_T005'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_T005 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_T005'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_/DSL/HR80_V005 USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
/DSL/HR80_T005-MANDT =
/DSL/HR80_V005-MANDT .
/DSL/HR80_T005-MOLGA =
/DSL/HR80_V005-MOLGA .
/DSL/HR80_T005-GRPID =
/DSL/HR80_V005-GRPID .
/DSL/HR80_T005-VRSID =
/DSL/HR80_V005-VRSID .
/DSL/HR80_T005-PERNR =
/DSL/HR80_V005-PERNR .
/DSL/HR80_T005-LGART =
/DSL/HR80_V005-LGART .
/DSL/HR80_T005-BEGDA =
/DSL/HR80_V005-BEGDA .
/DSL/HR80_T005-ENDDA =
/DSL/HR80_V005-ENDDA .
/DSL/HR80_T005-ANZHL =
/DSL/HR80_V005-ANZHL .
/DSL/HR80_T005-BETRG =
/DSL/HR80_V005-BETRG .
    SELECT * FROM T512W WHERE
LGART = /DSL/HR80_T005-LGART .
      SELECT SINGLE * FROM T512T WHERE
MOLGA = T512W-MOLGA AND
LGART = T512W-LGART AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
      ELSE.
        CLEAR SY-SUBRC.
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_T005-GRPID AND
VRSID = /DSL/HR80_T005-VRSID AND
MOLGA = /DSL/HR80_T005-MOLGA .
/DSL/HR80_V005-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T003-GRPID AND
MOLGA = /DSL/HR80_T003-MOLGA .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V005-GRPID_T =
/DSL/HR80_T001-GRPID_T .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V005-GRPID_T .
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V005-VRSID_T .
      CLEAR /DSL/HR80_V005-GRPID_T .
    ENDIF.
ENDFORM.
*...processing: /DSL/HR80_V007..................................*
FORM GET_DATA_/DSL/HR80_V007.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_T007 WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_V007 .
/DSL/HR80_V007-MANDT =
/DSL/HR80_T007-MANDT .
/DSL/HR80_V007-GRPID =
/DSL/HR80_T007-GRPID .
/DSL/HR80_V007-VRSID =
/DSL/HR80_T007-VRSID .
/DSL/HR80_V007-MOLGA =
/DSL/HR80_T007-MOLGA .
/DSL/HR80_V007-TRFAR =
/DSL/HR80_T007-TRFAR .
/DSL/HR80_V007-TRFGB =
/DSL/HR80_T007-TRFGB .
/DSL/HR80_V007-TRFKZ =
/DSL/HR80_T007-TRFKZ .
/DSL/HR80_V007-TRFGR =
/DSL/HR80_T007-TRFGR .
/DSL/HR80_V007-TRFST =
/DSL/HR80_T007-TRFST .
/DSL/HR80_V007-LGART =
/DSL/HR80_T007-LGART .
/DSL/HR80_V007-ENDDA =
/DSL/HR80_T007-ENDDA .
/DSL/HR80_V007-BEGDA =
/DSL/HR80_T007-BEGDA .
/DSL/HR80_V007-BETRG =
/DSL/HR80_T007-BETRG .
    SELECT SINGLE * FROM T510A WHERE
MOLGA = '47' AND
TRFAR = /DSL/HR80_T007-TRFAR .
    IF SY-SUBRC EQ 0.
    ENDIF.
    SELECT SINGLE * FROM T510G WHERE
MOLGA = '47' AND
TRFGB = /DSL/HR80_T007-TRFGB .
    IF SY-SUBRC EQ 0.
    ENDIF.
    SELECT * FROM T512W WHERE
MOLGA = '47' AND
LGART = /DSL/HR80_T007-LGART .
      SELECT SINGLE * FROM T512T WHERE
MOLGA = T512W-MOLGA AND
LGART = T512W-LGART AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
      ENDIF.
      EXIT.
    ENDSELECT.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_T007-GRPID AND
VRSID = /DSL/HR80_T007-VRSID AND
MOLGA = /DSL/HR80_T007-MOLGA .
/DSL/HR80_V007-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T003-GRPID AND
MOLGA = /DSL/HR80_T003-MOLGA .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V007-GRPID_T =
/DSL/HR80_T001-GRPID_T .
      ENDIF.
      EXIT.
    ENDSELECT.
<VIM_TOTAL_STRUC> = /DSL/HR80_V007.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_V007 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_V007.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_V007-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T007 WHERE
  GRPID = /DSL/HR80_V007-GRPID AND
  VRSID = /DSL/HR80_V007-VRSID AND
  MOLGA = /DSL/HR80_V007-MOLGA AND
  TRFAR = /DSL/HR80_V007-TRFAR AND
  TRFGB = /DSL/HR80_V007-TRFGB AND
  TRFKZ = /DSL/HR80_V007-TRFKZ AND
  TRFGR = /DSL/HR80_V007-TRFGR AND
  TRFST = /DSL/HR80_V007-TRFST AND
  LGART = /DSL/HR80_V007-LGART AND
  ENDDA = /DSL/HR80_V007-ENDDA .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_T007 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_T007 WHERE
  GRPID = /DSL/HR80_V007-GRPID AND
  VRSID = /DSL/HR80_V007-VRSID AND
  MOLGA = /DSL/HR80_V007-MOLGA AND
  TRFAR = /DSL/HR80_V007-TRFAR AND
  TRFGB = /DSL/HR80_V007-TRFGB AND
  TRFKZ = /DSL/HR80_V007-TRFKZ AND
  TRFGR = /DSL/HR80_V007-TRFGR AND
  TRFST = /DSL/HR80_V007-TRFST AND
  LGART = /DSL/HR80_V007-LGART AND
  ENDDA = /DSL/HR80_V007-ENDDA .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_T007.
    ENDIF.
/DSL/HR80_T007-MANDT =
/DSL/HR80_V007-MANDT .
/DSL/HR80_T007-GRPID =
/DSL/HR80_V007-GRPID .
/DSL/HR80_T007-VRSID =
/DSL/HR80_V007-VRSID .
/DSL/HR80_T007-MOLGA =
/DSL/HR80_V007-MOLGA .
/DSL/HR80_T007-TRFAR =
/DSL/HR80_V007-TRFAR .
/DSL/HR80_T007-TRFGB =
/DSL/HR80_V007-TRFGB .
/DSL/HR80_T007-TRFKZ =
/DSL/HR80_V007-TRFKZ .
/DSL/HR80_T007-TRFGR =
/DSL/HR80_V007-TRFGR .
/DSL/HR80_T007-TRFST =
/DSL/HR80_V007-TRFST .
/DSL/HR80_T007-LGART =
/DSL/HR80_V007-LGART .
/DSL/HR80_T007-ENDDA =
/DSL/HR80_V007-ENDDA .
/DSL/HR80_T007-BEGDA =
/DSL/HR80_V007-BEGDA .
/DSL/HR80_T007-BETRG =
/DSL/HR80_V007-BETRG .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_T007 ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_T007 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_V007-UPD_FLAG,
STATUS_/DSL/HR80_V007-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_V007.
  SELECT SINGLE * FROM /DSL/HR80_T007 WHERE
GRPID = /DSL/HR80_V007-GRPID AND
VRSID = /DSL/HR80_V007-VRSID AND
MOLGA = /DSL/HR80_V007-MOLGA AND
TRFAR = /DSL/HR80_V007-TRFAR AND
TRFGB = /DSL/HR80_V007-TRFGB AND
TRFKZ = /DSL/HR80_V007-TRFKZ AND
TRFGR = /DSL/HR80_V007-TRFGR AND
TRFST = /DSL/HR80_V007-TRFST AND
LGART = /DSL/HR80_V007-LGART AND
ENDDA = /DSL/HR80_V007-ENDDA .
/DSL/HR80_V007-MANDT =
/DSL/HR80_T007-MANDT .
/DSL/HR80_V007-GRPID =
/DSL/HR80_T007-GRPID .
/DSL/HR80_V007-VRSID =
/DSL/HR80_T007-VRSID .
/DSL/HR80_V007-MOLGA =
/DSL/HR80_T007-MOLGA .
/DSL/HR80_V007-TRFAR =
/DSL/HR80_T007-TRFAR .
/DSL/HR80_V007-TRFGB =
/DSL/HR80_T007-TRFGB .
/DSL/HR80_V007-TRFKZ =
/DSL/HR80_T007-TRFKZ .
/DSL/HR80_V007-TRFGR =
/DSL/HR80_T007-TRFGR .
/DSL/HR80_V007-TRFST =
/DSL/HR80_T007-TRFST .
/DSL/HR80_V007-LGART =
/DSL/HR80_T007-LGART .
/DSL/HR80_V007-ENDDA =
/DSL/HR80_T007-ENDDA .
/DSL/HR80_V007-BEGDA =
/DSL/HR80_T007-BEGDA .
/DSL/HR80_V007-BETRG =
/DSL/HR80_T007-BETRG .
    SELECT SINGLE * FROM T510A WHERE
MOLGA = '47' AND
TRFAR = /DSL/HR80_T007-TRFAR .
    IF SY-SUBRC EQ 0.
    ELSE.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT SINGLE * FROM T510G WHERE
MOLGA = '47' AND
TRFGB = /DSL/HR80_T007-TRFGB .
    IF SY-SUBRC EQ 0.
    ELSE.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT * FROM T512W WHERE
MOLGA = '47' AND
LGART = /DSL/HR80_T007-LGART .
      SELECT SINGLE * FROM T512T WHERE
MOLGA = T512W-MOLGA AND
LGART = T512W-LGART AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
      ELSE.
        CLEAR SY-SUBRC.
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_T007-GRPID AND
VRSID = /DSL/HR80_T007-VRSID AND
MOLGA = /DSL/HR80_T007-MOLGA .
/DSL/HR80_V007-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T003-GRPID AND
MOLGA = /DSL/HR80_T003-MOLGA .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V007-GRPID_T =
/DSL/HR80_T001-GRPID_T .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V007-GRPID_T .
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V007-VRSID_T .
      CLEAR /DSL/HR80_V007-GRPID_T .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_V007 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_V007-GRPID TO
/DSL/HR80_T007-GRPID .
MOVE /DSL/HR80_V007-VRSID TO
/DSL/HR80_T007-VRSID .
MOVE /DSL/HR80_V007-MOLGA TO
/DSL/HR80_T007-MOLGA .
MOVE /DSL/HR80_V007-TRFAR TO
/DSL/HR80_T007-TRFAR .
MOVE /DSL/HR80_V007-TRFGB TO
/DSL/HR80_T007-TRFGB .
MOVE /DSL/HR80_V007-TRFKZ TO
/DSL/HR80_T007-TRFKZ .
MOVE /DSL/HR80_V007-TRFGR TO
/DSL/HR80_T007-TRFGR .
MOVE /DSL/HR80_V007-TRFST TO
/DSL/HR80_T007-TRFST .
MOVE /DSL/HR80_V007-LGART TO
/DSL/HR80_T007-LGART .
MOVE /DSL/HR80_V007-ENDDA TO
/DSL/HR80_T007-ENDDA .
MOVE /DSL/HR80_V007-MANDT TO
/DSL/HR80_T007-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_T007'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_T007 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_T007'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_/DSL/HR80_V007 USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
/DSL/HR80_T007-MANDT =
/DSL/HR80_V007-MANDT .
/DSL/HR80_T007-GRPID =
/DSL/HR80_V007-GRPID .
/DSL/HR80_T007-VRSID =
/DSL/HR80_V007-VRSID .
/DSL/HR80_T007-MOLGA =
/DSL/HR80_V007-MOLGA .
/DSL/HR80_T007-TRFAR =
/DSL/HR80_V007-TRFAR .
/DSL/HR80_T007-TRFGB =
/DSL/HR80_V007-TRFGB .
/DSL/HR80_T007-TRFKZ =
/DSL/HR80_V007-TRFKZ .
/DSL/HR80_T007-TRFGR =
/DSL/HR80_V007-TRFGR .
/DSL/HR80_T007-TRFST =
/DSL/HR80_V007-TRFST .
/DSL/HR80_T007-LGART =
/DSL/HR80_V007-LGART .
/DSL/HR80_T007-ENDDA =
/DSL/HR80_V007-ENDDA .
/DSL/HR80_T007-BEGDA =
/DSL/HR80_V007-BEGDA .
/DSL/HR80_T007-BETRG =
/DSL/HR80_V007-BETRG .
    SELECT SINGLE * FROM T510A WHERE
MOLGA = '47' AND
TRFAR = /DSL/HR80_T007-TRFAR .
    IF SY-SUBRC EQ 0.
    ELSE.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT SINGLE * FROM T510G WHERE
MOLGA = '47' AND
TRFGB = /DSL/HR80_T007-TRFGB .
    IF SY-SUBRC EQ 0.
    ELSE.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT * FROM T512W WHERE
MOLGA = '47' AND
LGART = /DSL/HR80_T007-LGART .
      SELECT SINGLE * FROM T512T WHERE
MOLGA = T512W-MOLGA AND
LGART = T512W-LGART AND
SPRSL = SY-LANGU .
      IF SY-SUBRC EQ 0.
      ELSE.
        CLEAR SY-SUBRC.
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_T007-GRPID AND
VRSID = /DSL/HR80_T007-VRSID AND
MOLGA = /DSL/HR80_T007-MOLGA .
/DSL/HR80_V007-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_T003-GRPID AND
MOLGA = /DSL/HR80_T003-MOLGA .
      IF SY-SUBRC EQ 0.
/DSL/HR80_V007-GRPID_T =
/DSL/HR80_T001-GRPID_T .
      ELSE.
        CLEAR SY-SUBRC.
        CLEAR /DSL/HR80_V007-GRPID_T .
      ENDIF.
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_V007-VRSID_T .
      CLEAR /DSL/HR80_V007-GRPID_T .
    ENDIF.
ENDFORM.
*...processing: /DSL/HR80_VAGRP.................................*
FORM GET_DATA_/DSL/HR80_VAGRP.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_TAGRP WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_VAGRP .
/DSL/HR80_VAGRP-MANDT =
/DSL/HR80_TAGRP-MANDT .
/DSL/HR80_VAGRP-GRPID =
/DSL/HR80_TAGRP-GRPID .
/DSL/HR80_VAGRP-ALGRP =
/DSL/HR80_TAGRP-ALGRP .
/DSL/HR80_VAGRP-ALGTX =
/DSL/HR80_TAGRP-ALGTX .
/DSL/HR80_VAGRP-TRNSC =
/DSL/HR80_TAGRP-TRNSC .
/DSL/HR80_VAGRP-ICON =
/DSL/HR80_TAGRP-ICON .
/DSL/HR80_VAGRP-ZDESC =
/DSL/HR80_TAGRP-ZDESC .
    SELECT SINGLE * FROM ICON WHERE
ID = /DSL/HR80_TAGRP-ICON .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VAGRP-INTERNAL =
ICON-INTERNAL .
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_TGRP WHERE
GRPID = /DSL/HR80_TAGRP-GRPID .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VAGRP-GRPID_T =
/DSL/HR80_TGRP-GRPID_T .
    ENDIF.
<VIM_TOTAL_STRUC> = /DSL/HR80_VAGRP.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_VAGRP .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_VAGRP.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_VAGRP-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_TAGRP WHERE
  GRPID = /DSL/HR80_VAGRP-GRPID AND
  ALGRP = /DSL/HR80_VAGRP-ALGRP .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_TAGRP .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_TAGRP WHERE
  GRPID = /DSL/HR80_VAGRP-GRPID AND
  ALGRP = /DSL/HR80_VAGRP-ALGRP .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_TAGRP.
    ENDIF.
/DSL/HR80_TAGRP-MANDT =
/DSL/HR80_VAGRP-MANDT .
/DSL/HR80_TAGRP-GRPID =
/DSL/HR80_VAGRP-GRPID .
/DSL/HR80_TAGRP-ALGRP =
/DSL/HR80_VAGRP-ALGRP .
/DSL/HR80_TAGRP-ALGTX =
/DSL/HR80_VAGRP-ALGTX .
/DSL/HR80_TAGRP-TRNSC =
/DSL/HR80_VAGRP-TRNSC .
/DSL/HR80_TAGRP-ICON =
/DSL/HR80_VAGRP-ICON .
/DSL/HR80_TAGRP-ZDESC =
/DSL/HR80_VAGRP-ZDESC .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_TAGRP ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_TAGRP .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_VAGRP-UPD_FLAG,
STATUS_/DSL/HR80_VAGRP-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_VAGRP.
  SELECT SINGLE * FROM /DSL/HR80_TAGRP WHERE
GRPID = /DSL/HR80_VAGRP-GRPID AND
ALGRP = /DSL/HR80_VAGRP-ALGRP .
/DSL/HR80_VAGRP-MANDT =
/DSL/HR80_TAGRP-MANDT .
/DSL/HR80_VAGRP-GRPID =
/DSL/HR80_TAGRP-GRPID .
/DSL/HR80_VAGRP-ALGRP =
/DSL/HR80_TAGRP-ALGRP .
/DSL/HR80_VAGRP-ALGTX =
/DSL/HR80_TAGRP-ALGTX .
/DSL/HR80_VAGRP-TRNSC =
/DSL/HR80_TAGRP-TRNSC .
/DSL/HR80_VAGRP-ICON =
/DSL/HR80_TAGRP-ICON .
/DSL/HR80_VAGRP-ZDESC =
/DSL/HR80_TAGRP-ZDESC .
    SELECT SINGLE * FROM ICON WHERE
ID = /DSL/HR80_TAGRP-ICON .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VAGRP-INTERNAL =
ICON-INTERNAL .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VAGRP-INTERNAL .
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_TGRP WHERE
GRPID = /DSL/HR80_TAGRP-GRPID .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VAGRP-GRPID_T =
/DSL/HR80_TGRP-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VAGRP-GRPID_T .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_VAGRP USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_VAGRP-GRPID TO
/DSL/HR80_TAGRP-GRPID .
MOVE /DSL/HR80_VAGRP-ALGRP TO
/DSL/HR80_TAGRP-ALGRP .
MOVE /DSL/HR80_VAGRP-MANDT TO
/DSL/HR80_TAGRP-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_TAGRP'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_TAGRP TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_TAGRP'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_/DSL/HR80_VAGRP USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
/DSL/HR80_TAGRP-MANDT =
/DSL/HR80_VAGRP-MANDT .
/DSL/HR80_TAGRP-GRPID =
/DSL/HR80_VAGRP-GRPID .
/DSL/HR80_TAGRP-ALGRP =
/DSL/HR80_VAGRP-ALGRP .
/DSL/HR80_TAGRP-ALGTX =
/DSL/HR80_VAGRP-ALGTX .
/DSL/HR80_TAGRP-TRNSC =
/DSL/HR80_VAGRP-TRNSC .
/DSL/HR80_TAGRP-ICON =
/DSL/HR80_VAGRP-ICON .
/DSL/HR80_TAGRP-ZDESC =
/DSL/HR80_VAGRP-ZDESC .
    SELECT SINGLE * FROM ICON WHERE
ID = /DSL/HR80_TAGRP-ICON .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VAGRP-INTERNAL =
ICON-INTERNAL .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VAGRP-INTERNAL .
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_TGRP WHERE
GRPID = /DSL/HR80_TAGRP-GRPID .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VAGRP-GRPID_T =
/DSL/HR80_TGRP-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VAGRP-GRPID_T .
    ENDIF.
ENDFORM.
*...processing: /DSL/HR80_VGRP..................................*
FORM GET_DATA_/DSL/HR80_VGRP.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_TGRP WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_VGRP .
/DSL/HR80_VGRP-MANDT =
/DSL/HR80_TGRP-MANDT .
/DSL/HR80_VGRP-GRPID =
/DSL/HR80_TGRP-GRPID .
/DSL/HR80_VGRP-GRPID_T =
/DSL/HR80_TGRP-GRPID_T .
/DSL/HR80_VGRP-ICON =
/DSL/HR80_TGRP-ICON .
/DSL/HR80_VGRP-ZDESC =
/DSL/HR80_TGRP-ZDESC .
    SELECT SINGLE * FROM ICON WHERE
ID = /DSL/HR80_TGRP-ICON .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VGRP-INTERNAL =
ICON-INTERNAL .
    ENDIF.
<VIM_TOTAL_STRUC> = /DSL/HR80_VGRP.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_VGRP .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_VGRP.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_VGRP-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_TGRP WHERE
  GRPID = /DSL/HR80_VGRP-GRPID .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_TGRP .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_TGRP WHERE
  GRPID = /DSL/HR80_VGRP-GRPID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_TGRP.
    ENDIF.
/DSL/HR80_TGRP-MANDT =
/DSL/HR80_VGRP-MANDT .
/DSL/HR80_TGRP-GRPID =
/DSL/HR80_VGRP-GRPID .
/DSL/HR80_TGRP-GRPID_T =
/DSL/HR80_VGRP-GRPID_T .
/DSL/HR80_TGRP-ICON =
/DSL/HR80_VGRP-ICON .
/DSL/HR80_TGRP-ZDESC =
/DSL/HR80_VGRP-ZDESC .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_TGRP ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_TGRP .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_VGRP-UPD_FLAG,
STATUS_/DSL/HR80_VGRP-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_VGRP.
  SELECT SINGLE * FROM /DSL/HR80_TGRP WHERE
GRPID = /DSL/HR80_VGRP-GRPID .
/DSL/HR80_VGRP-MANDT =
/DSL/HR80_TGRP-MANDT .
/DSL/HR80_VGRP-GRPID =
/DSL/HR80_TGRP-GRPID .
/DSL/HR80_VGRP-GRPID_T =
/DSL/HR80_TGRP-GRPID_T .
/DSL/HR80_VGRP-ICON =
/DSL/HR80_TGRP-ICON .
/DSL/HR80_VGRP-ZDESC =
/DSL/HR80_TGRP-ZDESC .
    SELECT SINGLE * FROM ICON WHERE
ID = /DSL/HR80_TGRP-ICON .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VGRP-INTERNAL =
ICON-INTERNAL .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VGRP-INTERNAL .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_VGRP USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_VGRP-GRPID TO
/DSL/HR80_TGRP-GRPID .
MOVE /DSL/HR80_VGRP-MANDT TO
/DSL/HR80_TGRP-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_TGRP'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_TGRP TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_TGRP'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_/DSL/HR80_VGRP USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
/DSL/HR80_TGRP-MANDT =
/DSL/HR80_VGRP-MANDT .
/DSL/HR80_TGRP-GRPID =
/DSL/HR80_VGRP-GRPID .
/DSL/HR80_TGRP-GRPID_T =
/DSL/HR80_VGRP-GRPID_T .
/DSL/HR80_TGRP-ICON =
/DSL/HR80_VGRP-ICON .
/DSL/HR80_TGRP-ZDESC =
/DSL/HR80_VGRP-ZDESC .
    SELECT SINGLE * FROM ICON WHERE
ID = /DSL/HR80_TGRP-ICON .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VGRP-INTERNAL =
ICON-INTERNAL .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VGRP-INTERNAL .
    ENDIF.
ENDFORM.
*...processing: /DSL/HR80_VVERGD................................*
FORM GET_DATA_/DSL/HR80_VVERGD.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_TVERGD WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_VVERGD .
/DSL/HR80_VVERGD-MANDT =
/DSL/HR80_TVERGD-MANDT .
/DSL/HR80_VVERGD-MOLGA =
/DSL/HR80_TVERGD-MOLGA .
/DSL/HR80_VVERGD-GRPID =
/DSL/HR80_TVERGD-GRPID .
/DSL/HR80_VVERGD-VRSID =
/DSL/HR80_TVERGD-VRSID .
/DSL/HR80_VVERGD-GRTAX =
/DSL/HR80_TVERGD-GRTAX .
/DSL/HR80_VVERGD-DILIM =
/DSL/HR80_TVERGD-DILIM .
/DSL/HR80_VVERGD-ENDDA =
/DSL/HR80_TVERGD-ENDDA .
/DSL/HR80_VVERGD-BEGDA =
/DSL/HR80_TVERGD-BEGDA .
/DSL/HR80_VVERGD-ANBTR =
/DSL/HR80_TVERGD-ANBTR .
/DSL/HR80_VVERGD-ENBTR =
/DSL/HR80_TVERGD-ENBTR .
/DSL/HR80_VVERGD-WAERS =
/DSL/HR80_TVERGD-WAERS .
/DSL/HR80_VVERGD-PRZNT =
/DSL/HR80_TVERGD-PRZNT .
    SELECT SINGLE * FROM TCURC WHERE
WAERS = /DSL/HR80_TVERGD-WAERS .
    IF SY-SUBRC EQ 0.
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_TVERGD-GRPID AND
MOLGA = /DSL/HR80_TVERGD-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VVERGD-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_TVERGD-GRPID AND
VRSID = /DSL/HR80_TVERGD-VRSID AND
MOLGA = /DSL/HR80_TVERGD-MOLGA .
/DSL/HR80_VVERGD-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      EXIT.
    ENDSELECT.
<VIM_TOTAL_STRUC> = /DSL/HR80_VVERGD.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_VVERGD .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_VVERGD.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_VVERGD-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_TVERGD WHERE
  MOLGA = /DSL/HR80_VVERGD-MOLGA AND
  GRPID = /DSL/HR80_VVERGD-GRPID AND
  VRSID = /DSL/HR80_VVERGD-VRSID AND
  GRTAX = /DSL/HR80_VVERGD-GRTAX AND
  DILIM = /DSL/HR80_VVERGD-DILIM AND
  ENDDA = /DSL/HR80_VVERGD-ENDDA .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_TVERGD .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_TVERGD WHERE
  MOLGA = /DSL/HR80_VVERGD-MOLGA AND
  GRPID = /DSL/HR80_VVERGD-GRPID AND
  VRSID = /DSL/HR80_VVERGD-VRSID AND
  GRTAX = /DSL/HR80_VVERGD-GRTAX AND
  DILIM = /DSL/HR80_VVERGD-DILIM AND
  ENDDA = /DSL/HR80_VVERGD-ENDDA .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_TVERGD.
    ENDIF.
/DSL/HR80_TVERGD-MANDT =
/DSL/HR80_VVERGD-MANDT .
/DSL/HR80_TVERGD-MOLGA =
/DSL/HR80_VVERGD-MOLGA .
/DSL/HR80_TVERGD-GRPID =
/DSL/HR80_VVERGD-GRPID .
/DSL/HR80_TVERGD-VRSID =
/DSL/HR80_VVERGD-VRSID .
/DSL/HR80_TVERGD-GRTAX =
/DSL/HR80_VVERGD-GRTAX .
/DSL/HR80_TVERGD-DILIM =
/DSL/HR80_VVERGD-DILIM .
/DSL/HR80_TVERGD-ENDDA =
/DSL/HR80_VVERGD-ENDDA .
/DSL/HR80_TVERGD-BEGDA =
/DSL/HR80_VVERGD-BEGDA .
/DSL/HR80_TVERGD-ANBTR =
/DSL/HR80_VVERGD-ANBTR .
/DSL/HR80_TVERGD-ENBTR =
/DSL/HR80_VVERGD-ENBTR .
/DSL/HR80_TVERGD-WAERS =
/DSL/HR80_VVERGD-WAERS .
/DSL/HR80_TVERGD-PRZNT =
/DSL/HR80_VVERGD-PRZNT .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_TVERGD ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_TVERGD .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_VVERGD-UPD_FLAG,
STATUS_/DSL/HR80_VVERGD-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_VVERGD.
  SELECT SINGLE * FROM /DSL/HR80_TVERGD WHERE
MOLGA = /DSL/HR80_VVERGD-MOLGA AND
GRPID = /DSL/HR80_VVERGD-GRPID AND
VRSID = /DSL/HR80_VVERGD-VRSID AND
GRTAX = /DSL/HR80_VVERGD-GRTAX AND
DILIM = /DSL/HR80_VVERGD-DILIM AND
ENDDA = /DSL/HR80_VVERGD-ENDDA .
/DSL/HR80_VVERGD-MANDT =
/DSL/HR80_TVERGD-MANDT .
/DSL/HR80_VVERGD-MOLGA =
/DSL/HR80_TVERGD-MOLGA .
/DSL/HR80_VVERGD-GRPID =
/DSL/HR80_TVERGD-GRPID .
/DSL/HR80_VVERGD-VRSID =
/DSL/HR80_TVERGD-VRSID .
/DSL/HR80_VVERGD-GRTAX =
/DSL/HR80_TVERGD-GRTAX .
/DSL/HR80_VVERGD-DILIM =
/DSL/HR80_TVERGD-DILIM .
/DSL/HR80_VVERGD-ENDDA =
/DSL/HR80_TVERGD-ENDDA .
/DSL/HR80_VVERGD-BEGDA =
/DSL/HR80_TVERGD-BEGDA .
/DSL/HR80_VVERGD-ANBTR =
/DSL/HR80_TVERGD-ANBTR .
/DSL/HR80_VVERGD-ENBTR =
/DSL/HR80_TVERGD-ENBTR .
/DSL/HR80_VVERGD-WAERS =
/DSL/HR80_TVERGD-WAERS .
/DSL/HR80_VVERGD-PRZNT =
/DSL/HR80_TVERGD-PRZNT .
    SELECT SINGLE * FROM TCURC WHERE
WAERS = /DSL/HR80_TVERGD-WAERS .
    IF SY-SUBRC EQ 0.
    ELSE.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_TVERGD-GRPID AND
MOLGA = /DSL/HR80_TVERGD-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VVERGD-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VVERGD-GRPID_T .
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_TVERGD-GRPID AND
VRSID = /DSL/HR80_TVERGD-VRSID AND
MOLGA = /DSL/HR80_TVERGD-MOLGA .
/DSL/HR80_VVERGD-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VVERGD-VRSID_T .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_VVERGD USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_VVERGD-MOLGA TO
/DSL/HR80_TVERGD-MOLGA .
MOVE /DSL/HR80_VVERGD-GRPID TO
/DSL/HR80_TVERGD-GRPID .
MOVE /DSL/HR80_VVERGD-VRSID TO
/DSL/HR80_TVERGD-VRSID .
MOVE /DSL/HR80_VVERGD-GRTAX TO
/DSL/HR80_TVERGD-GRTAX .
MOVE /DSL/HR80_VVERGD-DILIM TO
/DSL/HR80_TVERGD-DILIM .
MOVE /DSL/HR80_VVERGD-ENDDA TO
/DSL/HR80_TVERGD-ENDDA .
MOVE /DSL/HR80_VVERGD-MANDT TO
/DSL/HR80_TVERGD-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_TVERGD'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_TVERGD TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_TVERGD'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_/DSL/HR80_VVERGD USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
/DSL/HR80_TVERGD-MANDT =
/DSL/HR80_VVERGD-MANDT .
/DSL/HR80_TVERGD-MOLGA =
/DSL/HR80_VVERGD-MOLGA .
/DSL/HR80_TVERGD-GRPID =
/DSL/HR80_VVERGD-GRPID .
/DSL/HR80_TVERGD-VRSID =
/DSL/HR80_VVERGD-VRSID .
/DSL/HR80_TVERGD-GRTAX =
/DSL/HR80_VVERGD-GRTAX .
/DSL/HR80_TVERGD-DILIM =
/DSL/HR80_VVERGD-DILIM .
/DSL/HR80_TVERGD-ENDDA =
/DSL/HR80_VVERGD-ENDDA .
/DSL/HR80_TVERGD-BEGDA =
/DSL/HR80_VVERGD-BEGDA .
/DSL/HR80_TVERGD-ANBTR =
/DSL/HR80_VVERGD-ANBTR .
/DSL/HR80_TVERGD-ENBTR =
/DSL/HR80_VVERGD-ENBTR .
/DSL/HR80_TVERGD-WAERS =
/DSL/HR80_VVERGD-WAERS .
/DSL/HR80_TVERGD-PRZNT =
/DSL/HR80_VVERGD-PRZNT .
    SELECT SINGLE * FROM TCURC WHERE
WAERS = /DSL/HR80_TVERGD-WAERS .
    IF SY-SUBRC EQ 0.
    ELSE.
      CLEAR SY-SUBRC.
    ENDIF.
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_TVERGD-GRPID AND
MOLGA = /DSL/HR80_TVERGD-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VVERGD-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VVERGD-GRPID_T .
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_TVERGD-GRPID AND
VRSID = /DSL/HR80_TVERGD-VRSID AND
MOLGA = /DSL/HR80_TVERGD-MOLGA .
/DSL/HR80_VVERGD-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VVERGD-VRSID_T .
    ENDIF.
ENDFORM.
*...processing: /DSL/HR80_VVERGI................................*
FORM GET_DATA_/DSL/HR80_VVERGI.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM /DSL/HR80_TVERGI WHERE
(VIM_WHERETAB) .
    CLEAR /DSL/HR80_VVERGI .
/DSL/HR80_VVERGI-MANDT =
/DSL/HR80_TVERGI-MANDT .
/DSL/HR80_VVERGI-MOLGA =
/DSL/HR80_TVERGI-MOLGA .
/DSL/HR80_VVERGI-GRPID =
/DSL/HR80_TVERGI-GRPID .
/DSL/HR80_VVERGI-VRSID =
/DSL/HR80_TVERGI-VRSID .
/DSL/HR80_VVERGI-GRTAX =
/DSL/HR80_TVERGI-GRTAX .
/DSL/HR80_VVERGI-SSKOD =
/DSL/HR80_TVERGI-SSKOD .
/DSL/HR80_VVERGI-SSGRP =
/DSL/HR80_TVERGI-SSGRP .
/DSL/HR80_VVERGI-ENDDA =
/DSL/HR80_TVERGI-ENDDA .
/DSL/HR80_VVERGI-BEGDA =
/DSL/HR80_TVERGI-BEGDA .
/DSL/HR80_VVERGI-OEZEL =
/DSL/HR80_TVERGI-OEZEL .
/DSL/HR80_VVERGI-COCUK =
/DSL/HR80_TVERGI-COCUK .
/DSL/HR80_VVERGI-IMBTR =
/DSL/HR80_TVERGI-IMBTR .
/DSL/HR80_VVERGI-AILE =
/DSL/HR80_TVERGI-AILE .
/DSL/HR80_VVERGI-WAERS =
/DSL/HR80_TVERGI-WAERS .
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_TVERGI-GRPID AND
MOLGA = /DSL/HR80_TVERGI-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VVERGI-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_TVERGI-GRPID AND
VRSID = /DSL/HR80_TVERGI-VRSID AND
MOLGA = /DSL/HR80_TVERGI-MOLGA .
/DSL/HR80_VVERGI-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      EXIT.
    ENDSELECT.
<VIM_TOTAL_STRUC> = /DSL/HR80_VVERGI.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_/DSL/HR80_VVERGI .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO /DSL/HR80_VVERGI.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_/DSL/HR80_VVERGI-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_TVERGI WHERE
  MOLGA = /DSL/HR80_VVERGI-MOLGA AND
  GRPID = /DSL/HR80_VVERGI-GRPID AND
  VRSID = /DSL/HR80_VVERGI-VRSID AND
  GRTAX = /DSL/HR80_VVERGI-GRTAX AND
  SSKOD = /DSL/HR80_VVERGI-SSKOD AND
  SSGRP = /DSL/HR80_VVERGI-SSGRP AND
  ENDDA = /DSL/HR80_VVERGI-ENDDA .
    IF SY-SUBRC = 0.
    DELETE /DSL/HR80_TVERGI .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM /DSL/HR80_TVERGI WHERE
  MOLGA = /DSL/HR80_VVERGI-MOLGA AND
  GRPID = /DSL/HR80_VVERGI-GRPID AND
  VRSID = /DSL/HR80_VVERGI-VRSID AND
  GRTAX = /DSL/HR80_VVERGI-GRTAX AND
  SSKOD = /DSL/HR80_VVERGI-SSKOD AND
  SSGRP = /DSL/HR80_VVERGI-SSGRP AND
  ENDDA = /DSL/HR80_VVERGI-ENDDA .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR /DSL/HR80_TVERGI.
    ENDIF.
/DSL/HR80_TVERGI-MANDT =
/DSL/HR80_VVERGI-MANDT .
/DSL/HR80_TVERGI-MOLGA =
/DSL/HR80_VVERGI-MOLGA .
/DSL/HR80_TVERGI-GRPID =
/DSL/HR80_VVERGI-GRPID .
/DSL/HR80_TVERGI-VRSID =
/DSL/HR80_VVERGI-VRSID .
/DSL/HR80_TVERGI-GRTAX =
/DSL/HR80_VVERGI-GRTAX .
/DSL/HR80_TVERGI-SSKOD =
/DSL/HR80_VVERGI-SSKOD .
/DSL/HR80_TVERGI-SSGRP =
/DSL/HR80_VVERGI-SSGRP .
/DSL/HR80_TVERGI-ENDDA =
/DSL/HR80_VVERGI-ENDDA .
/DSL/HR80_TVERGI-BEGDA =
/DSL/HR80_VVERGI-BEGDA .
/DSL/HR80_TVERGI-OEZEL =
/DSL/HR80_VVERGI-OEZEL .
/DSL/HR80_TVERGI-COCUK =
/DSL/HR80_VVERGI-COCUK .
/DSL/HR80_TVERGI-IMBTR =
/DSL/HR80_VVERGI-IMBTR .
/DSL/HR80_TVERGI-AILE =
/DSL/HR80_VVERGI-AILE .
/DSL/HR80_TVERGI-WAERS =
/DSL/HR80_VVERGI-WAERS .
    IF SY-SUBRC = 0.
    UPDATE /DSL/HR80_TVERGI ##WARN_OK.
    ELSE.
    INSERT /DSL/HR80_TVERGI .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_/DSL/HR80_VVERGI-UPD_FLAG,
STATUS_/DSL/HR80_VVERGI-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_/DSL/HR80_VVERGI.
  SELECT SINGLE * FROM /DSL/HR80_TVERGI WHERE
MOLGA = /DSL/HR80_VVERGI-MOLGA AND
GRPID = /DSL/HR80_VVERGI-GRPID AND
VRSID = /DSL/HR80_VVERGI-VRSID AND
GRTAX = /DSL/HR80_VVERGI-GRTAX AND
SSKOD = /DSL/HR80_VVERGI-SSKOD AND
SSGRP = /DSL/HR80_VVERGI-SSGRP AND
ENDDA = /DSL/HR80_VVERGI-ENDDA .
/DSL/HR80_VVERGI-MANDT =
/DSL/HR80_TVERGI-MANDT .
/DSL/HR80_VVERGI-MOLGA =
/DSL/HR80_TVERGI-MOLGA .
/DSL/HR80_VVERGI-GRPID =
/DSL/HR80_TVERGI-GRPID .
/DSL/HR80_VVERGI-VRSID =
/DSL/HR80_TVERGI-VRSID .
/DSL/HR80_VVERGI-GRTAX =
/DSL/HR80_TVERGI-GRTAX .
/DSL/HR80_VVERGI-SSKOD =
/DSL/HR80_TVERGI-SSKOD .
/DSL/HR80_VVERGI-SSGRP =
/DSL/HR80_TVERGI-SSGRP .
/DSL/HR80_VVERGI-ENDDA =
/DSL/HR80_TVERGI-ENDDA .
/DSL/HR80_VVERGI-BEGDA =
/DSL/HR80_TVERGI-BEGDA .
/DSL/HR80_VVERGI-OEZEL =
/DSL/HR80_TVERGI-OEZEL .
/DSL/HR80_VVERGI-COCUK =
/DSL/HR80_TVERGI-COCUK .
/DSL/HR80_VVERGI-IMBTR =
/DSL/HR80_TVERGI-IMBTR .
/DSL/HR80_VVERGI-AILE =
/DSL/HR80_TVERGI-AILE .
/DSL/HR80_VVERGI-WAERS =
/DSL/HR80_TVERGI-WAERS .
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_TVERGI-GRPID AND
MOLGA = /DSL/HR80_TVERGI-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VVERGI-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VVERGI-GRPID_T .
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_TVERGI-GRPID AND
VRSID = /DSL/HR80_TVERGI-VRSID AND
MOLGA = /DSL/HR80_TVERGI-MOLGA .
/DSL/HR80_VVERGI-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VVERGI-VRSID_T .
    ENDIF.
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_/DSL/HR80_VVERGI USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE /DSL/HR80_VVERGI-MOLGA TO
/DSL/HR80_TVERGI-MOLGA .
MOVE /DSL/HR80_VVERGI-GRPID TO
/DSL/HR80_TVERGI-GRPID .
MOVE /DSL/HR80_VVERGI-VRSID TO
/DSL/HR80_TVERGI-VRSID .
MOVE /DSL/HR80_VVERGI-GRTAX TO
/DSL/HR80_TVERGI-GRTAX .
MOVE /DSL/HR80_VVERGI-SSKOD TO
/DSL/HR80_TVERGI-SSKOD .
MOVE /DSL/HR80_VVERGI-SSGRP TO
/DSL/HR80_TVERGI-SSGRP .
MOVE /DSL/HR80_VVERGI-ENDDA TO
/DSL/HR80_TVERGI-ENDDA .
MOVE /DSL/HR80_VVERGI-MANDT TO
/DSL/HR80_TVERGI-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = '/DSL/HR80_TVERGI'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN /DSL/HR80_TVERGI TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING '/DSL/HR80_TVERGI'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
FORM COMPL_/DSL/HR80_VVERGI USING WORKAREA.
*      provides (read-only) fields from secondary tables related
*      to primary tables by foreignkey relationships
/DSL/HR80_TVERGI-MANDT =
/DSL/HR80_VVERGI-MANDT .
/DSL/HR80_TVERGI-MOLGA =
/DSL/HR80_VVERGI-MOLGA .
/DSL/HR80_TVERGI-GRPID =
/DSL/HR80_VVERGI-GRPID .
/DSL/HR80_TVERGI-VRSID =
/DSL/HR80_VVERGI-VRSID .
/DSL/HR80_TVERGI-GRTAX =
/DSL/HR80_VVERGI-GRTAX .
/DSL/HR80_TVERGI-SSKOD =
/DSL/HR80_VVERGI-SSKOD .
/DSL/HR80_TVERGI-SSGRP =
/DSL/HR80_VVERGI-SSGRP .
/DSL/HR80_TVERGI-ENDDA =
/DSL/HR80_VVERGI-ENDDA .
/DSL/HR80_TVERGI-BEGDA =
/DSL/HR80_VVERGI-BEGDA .
/DSL/HR80_TVERGI-OEZEL =
/DSL/HR80_VVERGI-OEZEL .
/DSL/HR80_TVERGI-COCUK =
/DSL/HR80_VVERGI-COCUK .
/DSL/HR80_TVERGI-IMBTR =
/DSL/HR80_VVERGI-IMBTR .
/DSL/HR80_TVERGI-AILE =
/DSL/HR80_VVERGI-AILE .
/DSL/HR80_TVERGI-WAERS =
/DSL/HR80_VVERGI-WAERS .
    SELECT SINGLE * FROM /DSL/HR80_T001 WHERE
GRPID = /DSL/HR80_TVERGI-GRPID AND
MOLGA = /DSL/HR80_TVERGI-MOLGA .
    IF SY-SUBRC EQ 0.
/DSL/HR80_VVERGI-GRPID_T =
/DSL/HR80_T001-GRPID_T .
    ELSE.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VVERGI-GRPID_T .
    ENDIF.
    SELECT * FROM /DSL/HR80_T003 WHERE
GRPID = /DSL/HR80_TVERGI-GRPID AND
VRSID = /DSL/HR80_TVERGI-VRSID AND
MOLGA = /DSL/HR80_TVERGI-MOLGA .
/DSL/HR80_VVERGI-VRSID_T =
/DSL/HR80_T003-VRSID_T .
      EXIT.
    ENDSELECT.
    IF SY-SUBRC NE 0.
      CLEAR SY-SUBRC.
      CLEAR /DSL/HR80_VVERGI-VRSID_T .
    ENDIF.
ENDFORM.
